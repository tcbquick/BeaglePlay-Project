
---
- name: Configure Docker Swarm
  hosts:
    - ansible-Con-troller
    - Main-Con-troller
    - Main-Con-sole
    - Main-Con-nection
    - Swarm-Client-01
    - Swarm-Client-02
  become: yes

  tasks:
    - name: Initialize Docker Swarm on the primary manager (ansible-Con-troller)
      command: docker swarm init
      when: inventory_hostname == 'ansible-Con-troller'

    - name: Retrieve Swarm join token for managers
      command: docker swarm join-token manager -q
      register: manager_token
      when: inventory_hostname == 'ansible-Con-troller'

    - name: Retrieve Swarm join token for workers
      command: docker swarm join-token worker -q
      register: worker_token
      when: inventory_hostname == 'ansible-Con-troller'

    - name: Join other managers to the swarm
      command: docker swarm join --token {{ hostvars['ansible-Con-troller'].manager_token }} ansible-Con-troller:2377
      when: inventory_hostname in ['Main-Con-troller', 'Main-Con-sole', 'Main-Con-nection']

    - name: Join workers to the swarm
      command: docker swarm join --token {{ hostvars['ansible-Con-troller'].worker_token }} ansible-Con-troller:2377
      when: inventory_hostname in ['Swarm-Client-01', 'Swarm-Client-02']
